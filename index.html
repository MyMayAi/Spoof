<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f172a" />
  <title>Chef Academy - Evolution</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; touch-action: none; overflow: hidden; color: white; }
    
    /* Navigazione */
    #side-menu {
      position: fixed; top: 0; left: 0; width: 280px; height: 100%;
      background: #1e293b; z-index: 200; transform: translateX(-100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 20px 0 50px rgba(0,0,0,0.8);
    }
    #side-menu.open { transform: translateX(0); }
    #menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 150; display: none; backdrop-filter: blur(8px); }

    .page { position: absolute; inset: 0; background: #0f172a; display: none; flex-direction: column; }
    .page.active { display: flex; }

    /* --- STILI NUOVO FORMATO (GALAXY UI) --- */
    .galaxy-container { position: relative; flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
    
    .orbit-outer {
      position: relative; width: 320px; height: 320px;
      border-radius: 50%; border: 1px solid rgba(255,255,255,0.05);
      display: flex; align-items: center; justify-content: center;
    }

    .main-dial {
      position: relative; width: 220px; height: 220px;
      background: radial-gradient(circle at 30% 30%, #334155, #0f172a);
      border-radius: 50%; box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.1);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 10; border: 4px solid #1e293b;
    }

    .orbital-slider {
      position: absolute; width: 300px; height: 300px;
      border-radius: 50%; border: 2px solid transparent;
      border-top-color: #fbbf24; transition: transform 0.1s linear;
      filter: drop-shadow(0 0 10px #fbbf24);
    }

    .glass-pill {
      background: rgba(255,255,255,0.03); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.05); border-radius: 20px;
    }

    /* Floating Tags */
    .float-tag { position: absolute; font-size: 10px; font-weight: 800; color: #94a3b8; text-transform: uppercase; }

    /* Animazioni */
    @keyframes pulse-glow { 0% { opacity: 0.3; } 50% { opacity: 0.6; } 100% { opacity: 0.3; } }
    .glow-active { animation: pulse-glow 2s infinite; }

    /* Custom Input Range per Galaxy */
    .galaxy-range {
      -webkit-appearance: none; width: 80%; height: 4px; background: #1e293b;
      border-radius: 2px; outline: none; margin-top: 40px;
    }
    .galaxy-range::-webkit-slider-thumb {
      -webkit-appearance: none; width: 24px; height: 24px; background: #fbbf24;
      border-radius: 50%; cursor: pointer; box-shadow: 0 0 15px #fbbf24;
    }
  </style>
</head>
<body>

    <div id="menu-overlay" onclick="toggleMenu()"></div>
    <nav id="side-menu" class="p-8">
        <div class="mb-12">
            <h2 class="text-2xl font-black text-amber-500 tracking-tighter">CHEF ACADEMY</h2>
            <div class="h-1 w-10 bg-amber-500 mt-2"></div>
        </div>
        <div class="space-y-3">
            <button onclick="switchPage('nuovo-formato')" class="w-full flex items-center p-4 rounded-2xl bg-amber-500 text-slate-900 font-black shadow-lg">
                <span class="mr-3">‚ú®</span> NUOVO FORMATO
            </button>
            <button onclick="switchPage('bilancia')" class="w-full flex items-center p-4 rounded-2xl hover:bg-slate-800 text-slate-300 font-bold">
                <span class="mr-3">‚öñÔ∏è</span> Bilancia Classic
            </button>
            <button onclick="switchPage('convertitore')" class="w-full flex items-center p-4 rounded-2xl hover:bg-slate-800 text-slate-300 font-bold">
                <span class="mr-3">üç≥</span> Crudo vs Cotto
            </button>
        </div>
    </nav>

    <div id="page-nuovo-formato" class="page active">
        <header class="p-6 flex justify-between items-center">
            <button onclick="toggleMenu()" class="p-3 glass-pill text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
            <span class="text-[10px] font-black tracking-[0.3em] uppercase opacity-50">Evolution UI</span>
            <div class="w-12"></div>
        </header>

        <div class="galaxy-container">
            <div class="float-tag top-10">Dose Corrente</div>
            
            <div class="orbit-outer">
                <div id="galaxyOrbital" class="orbital-slider"></div>
                
                <div class="main-dial">
                    <span id="gxUnits" class="text-7xl font-black tracking-tighter">0</span>
                    <span id="gxLabel" class="text-[10px] font-bold text-amber-500 uppercase tracking-widest mt-2">Cucchiai</span>
                    <div class="flex items-center mt-4 glass-pill px-3 py-1">
                        <span id="gxGrams" class="text-sm font-bold text-white">0</span>
                        <span class="text-[10px] ml-1 opacity-50">grammi</span>
                    </div>
                </div>

                <div class="absolute -right-4 top-20 glass-pill p-3 text-center min-w-[60px]">
                    <span id="gxKcal" class="text-lg font-black text-amber-500 block">0</span>
                    <span class="text-[8px] uppercase opacity-40">Kcal</span>
                </div>
            </div>

            <div class="w-full px-6 mt-12 overflow-x-auto no-scrollbar flex space-x-4 py-4">
                <div onclick="selectGxFood('farina')" class="gx-food active flex flex-col items-center flex-shrink-0" data-food="farina">
                    <div class="w-14 h-14 rounded-full glass-pill flex items-center justify-center mb-2"><img src="./flour.png" class="w-8"></div>
                    <span class="text-[8px] font-bold uppercase">Farina</span>
                </div>
                <div onclick="selectGxFood('olio')" class="gx-food flex flex-col items-center flex-shrink-0" data-food="olio">
                    <div class="w-14 h-14 rounded-full glass-pill flex items-center justify-center mb-2"><img src="./oil.png" class="w-8"></div>
                    <span class="text-[8px] font-bold uppercase">Olio</span>
                </div>
                <div onclick="selectGxFood('riso')" class="gx-food flex flex-col items-center flex-shrink-0" data-food="riso">
                    <div class="w-14 h-14 rounded-full glass-pill flex items-center justify-center mb-2"><img src="./rice.png" class="w-8"></div>
                    <span class="text-[8px] font-bold uppercase">Riso</span>
                </div>
            </div>

            <input type="range" id="gxSlider" min="0" max="500" value="0" oninput="updateGalaxy()" class="galaxy-range">
            <p id="gxSubText" class="text-[10px] font-bold text-amber-500/50 uppercase mt-4 tracking-widest">Sposta il cursore per pesare</p>
        </div>

        <footer class="p-8 flex justify-around items-center glass-pill mx-6 mb-8">
            <button onclick="setGxTool('cucchiaio')" class="gx-tool active text-amber-500" id="gx-cucchiaio">ü•Ñ</button>
            <button onclick="setGxTool('cucchiaino')" class="gx-tool opacity-30" id="gx-cucchiaino">üç¥</button>
            <button onclick="setGxTool('tazzina')" class="gx-tool opacity-30" id="gx-tazzina">‚òï</button>
            <button onclick="setGxTool('bicchiere')" class="gx-tool opacity-30" id="gx-bicchiere">ü•É</button>
        </footer>
    </div>

    <div id="page-bilancia" class="page">
        <div class="flex-1 flex items-center justify-center text-slate-500 text-xs font-bold uppercase">
            Sezione Classic - Vedi codice precedente
        </div>
    </div>

    <div id="page-convertitore" class="page">
        <div class="flex-1 flex items-center justify-center text-slate-500 text-xs font-bold uppercase">
            Sezione Convertitore - Vedi codice precedente
        </div>
    </div>

    <script>
        const db = {
            farina: { name: "Farina", kcal: 364, w: { cucchiaio: 12, cucchiaino: 4, tazzina: 60, bicchiere: 120 } },
            olio: { name: "Olio", kcal: 884, w: { cucchiaio: 9, cucchiaino: 3, tazzina: 80, bicchiere: 180 } },
            riso: { name: "Riso", kcal: 130, w: { cucchiaio: 20, cucchiaino: 7, tazzina: 90, bicchiere: 220 } }
        };

        let gxState = { food: 'farina', tool: 'cucchiaio', grams: 0 };

        function toggleMenu() {
            const menu = document.getElementById('side-menu');
            const overlay = document.getElementById('menu-overlay');
            const isOpen = menu.classList.contains('open');
            menu.classList.toggle('open');
            overlay.style.display = isOpen ? 'none' : 'block';
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            toggleMenu();
        }

        // --- LOGICA NUOVO FORMATO (DEEP DEBUG) ---

        function updateGalaxy() {
            const val = parseInt(document.getElementById('gxSlider').value);
            gxState.grams = val;
            
            const f = db[gxState.food];
            const tw = f.w[gxState.tool];
            const units = val / tw;
            const floorUnits = Math.floor(units);
            const percent = (units % 1) * 100;

            // Update UI
            document.getElementById('gxUnits').innerText = floorUnits;
            document.getElementById('gxGrams').innerText = val;
            document.getElementById('gxKcal').innerText = Math.round((f.kcal * val) / 100);
            
            // Ruota l'anello orbitale (0-360 gradi basato sul progresso della dose)
            const rotation = (percent / 100) * 360;
            document.getElementById('galaxyOrbital').style.transform = `rotate(${rotation}deg)`;
            
            // Vibrazione agli scatti
            if (val % tw === 0 && val !== 0) {
                if (navigator.vibrate) navigator.vibrate([10, 30, 10]);
                document.querySelector('.main-dial').style.borderColor = "#fbbf24";
                setTimeout(() => document.querySelector('.main-dial').style.borderColor = "#1e293b", 200);
            }

            document.getElementById('gxSubText').innerText = val % tw > 0 ? `+ ${val % tw}g restanti` : "Dose Perfetta!";
        }

        function selectGxFood(key) {
            gxState.food = key;
            document.querySelectorAll('.gx-food').forEach(el => el.style.opacity = "0.3");
            event.currentTarget.style.opacity = "1";
            updateGalaxy();
        }

        function setGxTool(tool) {
            gxState.tool = tool;
            document.querySelectorAll('.gx-tool').forEach(el => el.classList.add('opacity-30'));
            document.getElementById('gx-' + tool).classList.remove('opacity-30');
            document.getElementById('gxLabel').innerText = tool;
            updateGalaxy();
        }

        // Inizializzazione
        updateGalaxy();
    </script>
</body>
</html>
