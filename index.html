<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Chef Academy 2026 - Minimal Elegance</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700;800&display=swap" rel="stylesheet" />
  <style>
    :root { --p-level: 0%; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: #fdfdfd; margin: 0; overflow: hidden; height: 100vh; user-select: none; -webkit-user-select: none; color: #1e293b; }
    
    .header-box { position: relative; z-index: 50; background: #0f172a; padding: 1.8rem 1.5rem; color: white; border-radius: 0 0 3rem 3rem; box-shadow: 0 10px 30px rgba(15,23,42,0.1); }
    .liquid-bg { position: absolute; bottom: 0; left: 0; width: 100%; height: var(--p-level); background: linear-gradient(0deg, rgba(251,191,36,0.15) 0%, rgba(251,191,36,0) 100%); z-index: 1; pointer-events: none; transition: height 0.4s cubic-bezier(0.23, 1, 0.32, 1); }

    /* CESTINO ELEGANTE (GLASSMORPHISM) */
    #drop-delete { 
        position: fixed; bottom: 0; width: 100%; height: 140px; 
        background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        z-index: 999999; transform: translateY(100%); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); 
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
        border-top: 1px solid rgba(255,255,255,0.2);
    }
    #drop-delete.show { transform: translateY(0); }
    #drop-delete.active-drop { background: rgba(239, 68, 68, 0.1); border-top-color: rgba(239, 68, 68, 0.5); }
    #drop-delete .trash-icon { font-size: 2rem; filter: grayscale(1); transition: 0.3s; opacity: 0.5; }
    #drop-delete.active-drop .trash-icon { filter: grayscale(0); opacity: 1; transform: scale(1.2); }

    /* TOOL MODAL */
    #tool-modal { position: fixed; inset: 0; background: rgba(15,23,42,0.9); z-index: 1000000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
    .tool-option { background: rgba(255,255,255,0.03); width: 100%; max-width: 280px; margin: 0.6rem; padding: 1.4rem; border-radius: 2rem; color: white; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: space-between; }
    .tool-option.active { background: rgba(251,191,36,0.1); border-color: #fbbf24; }

    /* RULER */
    #ruler { position: relative; height: 100px; background: transparent; overflow: hidden; touch-action: none; }
    .track { display: flex; align-items: flex-end; position: absolute; left: 50%; height: 100%; pointer-events: none; }
    .tack { width: 1.5px; height: 15px; background: #e2e8f0; margin-right: 25px; flex-shrink: 0; transition: height 0.2s; }
    .tack.big { height: 35px; background: #cbd5e1; position: relative; }
    .tack.big::after { content: attr(data-v); position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 9px; font-weight: 700; color: #94a3b8; }

    .food-card { background: white; padding: 1.2rem; border-radius: 2.2rem; text-align: center; border: 1px solid #f1f5f9; box-shadow: 0 4px 20px rgba(0,0,0,0.02); transition: 0.3s; }
    .food-card.active { border-color: #fbbf24; background: #fffbeb; box-shadow: 0 10px 30px rgba(251,191,36,0.1); }
    
    .fav-item { background: white; padding: 0.8rem; border-radius: 1.4rem; min-width: 75px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.04); border: 1px solid #f1f5f9; }
    .no-scrollbar::-webkit-scrollbar { display: none; }

    /* GHOST DRAGGING LAYER */
    .drag-ghost { position: fixed !important; pointer-events: none; z-index: 2000000 !important; opacity: 0.8; transform: scale(1.15); box-shadow: 0 20px 40px rgba(0,0,0,0.15) !important; }
  </style>
</head>
<body onclick="unlockAudio()">

  <div id="drop-delete">
    <div class="trash-icon mb-2">üóëÔ∏è</div>
    <span class="text-[9px] font-bold uppercase tracking-[0.3em] text-slate-400">Rilascia per rimuovere</span>
  </div>

  <div id="tool-modal" onclick="closeModal()">
      <div class="text-white/40 font-bold text-[10px] tracking-[0.4em] mb-10 uppercase">Seleziona Utensile</div>
      <div id="modal-list" class="w-full flex flex-col items-center"></div>
  </div>

  <div class="flex flex-col h-full">
      <div class="header-box">
          <div class="liquid-bg" id="liquid"></div>
          <div class="relative z-10 flex justify-between items-end">
              <div onclick="openModal(event)" class="bg-white/5 p-4 rounded-[2rem] border border-white/10 text-center min-w-[90px] backdrop-blur-md">
                  <div id="curEmoji" class="text-3xl mb-1">ü•Ñ</div>
                  <div id="curLabel" class="text-[7px] font-black text-amber-400 uppercase tracking-widest">Utensile</div>
              </div>
              
              <div class="flex-1 text-right pr-4">
                  <div class="text-7xl font-light tracking-tighter leading-none text-white"><span id="dosi">0</span><span class="text-lg text-amber-500 font-bold ml-1">.0</span></div>
                  <div id="kcal" class="text-[9px] font-bold opacity-30 uppercase tracking-[0.2em] mt-2">0 Calories</div>
              </div>

              <button onclick="saveFav()" class="bg-amber-500 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-2xl active:scale-90 transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/></svg>
              </button>
          </div>
      </div>

      <main class="flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar">
          <div id="favs-list" class="flex gap-4 overflow-x-auto pb-4 no-scrollbar min-h-[90px] items-center"></div>
          <div class="grid grid-cols-3 gap-4" id="grid"></div>
      </main>

      <footer class="bg-white px-8 pb-10 pt-4">
          <div class="flex justify-between items-center mb-6">
              <button onclick="reset()" class="text-slate-300 text-[9px] font-bold uppercase tracking-widest hover:text-red-400 transition-colors">Reset</button>
              <div class="text-4xl font-bold text-slate-800 tracking-tighter"><span id="grams">0</span><span class="text-amber-500 text-sm ml-1 font-black">GR</span></div>
          </div>
          <div id="ruler">
              <div class="absolute left-1/2 -translate-x-1/2 bottom-0 w-[2px] h-14 bg-amber-500 z-50 shadow-[0_0_15px_rgba(251,191,36,0.5)]"></div>
              <div id="track" class="track"></div>
          </div>
      </footer>
  </div>

<script>
    const db = {
        farina: { e: "üåæ", k: 364, w: { cucchiaio: 12, cucchiaino: 4, tazzina: 60, bicchiere: 120 } },
        olio: { e: "ü´í", k: 884, w: { cucchiaio: 9, cucchiaino: 3, tazzina: 80, bicchiere: 180 } },
        riso: { e: "üçö", k: 130, w: { cucchiaio: 20, cucchiaino: 7, tazzina: 90, bicchiere: 220 } },
        zucchero: { e: "üç¨", k: 387, w: { cucchiaio: 15, cucchiaino: 5, tazzina: 80, bicchiere: 180 } },
        pasta: { e: "üçù", k: 350, w: { cucchiaio: 15, cucchiaino: 5, tazzina: 60, bicchiere: 100 } }
    };
    const tools = { cucchiaio: 'ü•Ñ', cucchiaino: 'üç¥', tazzina: '‚òï', bicchiere: 'ü•É' };
    let state = { food: 'farina', tool: 'cucchiaio', g: 0, favs: [] };
    let ctx = null, curX = 0;

    function unlockAudio() { if(!ctx) ctx = new AudioContext(); if(ctx.state==='suspended') ctx.resume(); }
    
    // SUONI MINIMAL ED ELEGANTI
    function softTic(freq, vol=0.05) {
        if(!ctx) return;
        let o=ctx.createOscillator(), g=ctx.createGain();
        o.type='sine'; o.frequency.setValueAtTime(freq, ctx.currentTime);
        g.gain.setValueAtTime(vol, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.05);
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + 0.05);
    }

    function openModal(e) { e.preventDefault(); e.stopPropagation(); document.getElementById('tool-modal').style.display = 'flex'; softTic(1200, 0.1); }
    function closeModal() { document.getElementById('tool-modal').style.display = 'none'; }

    function init() {
        const g = document.getElementById('grid');
        Object.keys(db).forEach(k => {
            let d = document.createElement('div');
            d.className = "food-card"; d.id = "f-"+k;
            d.innerHTML = `<span class="text-3xl block mb-2">${db[k].e}</span><span class="text-[7px] font-black uppercase text-slate-300 tracking-widest">${k}</span>`;
            d.onclick = () => { state.food = k; update(); softTic(800, 0.05); };
            g.appendChild(d);
        });

        const ml = document.getElementById('modal-list');
        Object.keys(tools).forEach(k => {
            let d = document.createElement('div');
            d.className = "tool-option"; d.id = "topt-"+k;
            d.innerHTML = `<span class="text-xl">${tools[k]} ${k.toUpperCase()}</span><span class="text-[10px] opacity-20">‚Üí</span>`;
            d.onclick = (e) => { e.stopPropagation(); state.tool = k; update(); closeModal(); softTic(1500, 0.1); };
            ml.appendChild(d);
        });

        const tr = document.getElementById('track');
        for(let i=0; i<=500; i++) {
            let t = document.createElement('div');
            t.className = i%10===0 ? 'tack big' : 'tack';
            if(i%10===0) t.setAttribute('data-v', i);
            tr.appendChild(t);
        }

        let isD = false, sX = 0;
        document.getElementById('ruler').addEventListener('touchstart', (e) => { isD = true; sX = e.touches[0].clientX - curX; unlockAudio(); }, {passive: true});
        window.addEventListener('touchmove', (e) => { 
            if(!isD) return; 
            let oldG = state.g;
            curX = e.touches[0].clientX - sX; 
            if(curX>0) curX=0; state.g = Math.abs(Math.round(curX/25)); 
            if(state.g !== oldG) {
                update(); 
                if(state.g % 10 === 0) softTic(2000, 0.02); // Tic leggerissimo durante lo scroll
            }
        }, {passive: true});
        window.addEventListener('touchend', () => isD = false);
        update();
    }

    function update() {
        const f = db[state.food], tw = f.w[state.tool], u = state.g / tw;
        document.getElementById('dosi').innerText = Math.floor(u);
        document.getElementById('grams').innerText = state.g;
        document.getElementById('curEmoji').innerText = tools[state.tool];
        document.getElementById('kcal').innerText = Math.round(f.k * state.g / 100) + " CALORIES";
        document.getElementById('track').style.transform = `translateX(${curX}px)`;
        document.documentElement.style.setProperty('--p-level', (u%1*100)+'%');
        
        document.querySelectorAll('.food-card').forEach(c => c.classList.remove('active'));
        document.getElementById('f-'+state.food).classList.add('active');

        if(state.g > 0 && state.g % tw === 0) { softTic(3000, 0.2); navigator.vibrate?.(10); }
    }

    function saveFav() {
        if(state.g === 0) return;
        state.favs.unshift({ id: Date.now(), g: state.g, foodKey: state.food, emoji: db[state.food].e });
        renderFavs(); softTic(2500, 0.1);
    }

    function renderFavs() {
        const list = document.getElementById('favs-list');
        const trash = document.getElementById('drop-delete');
        list.innerHTML = '';
        state.favs.forEach(f => {
            let d = document.createElement('div');
            d.className = "fav-item";
            d.innerHTML = `<span class="text-2xl block">${f.emoji}</span><span class="text-[9px] font-bold text-slate-400">${f.g}g</span>`;
            
            let startX, startY, ghost, isDragging = false;

            d.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX; startY = e.touches[0].clientY;
                unlockAudio();
            }, {passive: true});

            d.addEventListener('touchmove', (e) => {
                let dx = e.touches[0].clientX - startX;
                let dy = e.touches[0].clientY - startY;
                
                if(Math.abs(dy) > 20 || isDragging) {
                    if(!isDragging) { 
                        isDragging = true; 
                        trash.classList.add('show');
                        d.style.opacity = "0.2";
                        // CREIAMO IL GHOST SUL BODY (FIX LAYER)
                        ghost = d.cloneNode(true);
                        ghost.className = "fav-item drag-ghost";
                        document.body.appendChild(ghost);
                    }
                    ghost.style.left = (e.touches[0].clientX - 37) + "px";
                    ghost.style.top = (e.touches[0].clientY - 37) + "px";

                    if(e.touches[0].clientY > window.innerHeight - 140) {
                        trash.classList.add('active-drop');
                    } else {
                        trash.classList.remove('active-drop');
                    }
                }
            }, {passive: false});

            d.addEventListener('touchend', (e) => {
                trash.classList.remove('show', 'active-drop');
                if(ghost) ghost.remove();
                d.style.opacity = "1";

                if(!isDragging) {
                    state.food = f.foodKey; state.g = f.g; curX = -(f.g * 25); 
                    update(); softTic(1000, 0.1);
                } else if(e.changedTouches[0].clientY > window.innerHeight - 140) {
                    state.favs = state.favs.filter(x => x.id !== f.id);
                    renderFavs(); softTic(200, 0.1); // Suono basso per eliminazione
                    navigator.vibrate?.(30);
                }
                isDragging = false;
            });
            list.appendChild(d);
        });
    }

    function reset() { curX = 0; state.g = 0; update(); softTic(150, 0.1); }
    init();
</script>
</body>
</html>
